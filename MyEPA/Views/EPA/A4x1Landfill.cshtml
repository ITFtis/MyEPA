@{
    Layout = "~/Views/_Layout.cshtml";
}
@Html.ActionLink("返回", "A4x1", "EPA", "", new { @class = "btn btn-basic fa fa-arrow-circle-left", @style = "color:white;padding:4px" })
<div class="text-center">
    <br />
    <h5>營運中心公有垃圾掩埋場</h5>
    <br />
</div>
<div class="container-fluid">
    <div class="row">
        <div class="col-12 col-sm-6">
            <div id="EditArea" style="padding:0px;">
                <span style="width:30%">聯繫單位名稱：</span>
                @Html.TextBox("EditingContactUnit", "", new { @readonly = "readonly", @style = "border:none; width:70%" })
                <br />
                X位置： @Html.TextBox("EditingXpos", "", new { @readonly = "readonly", @style = "border:none;width:150px" })
                Y位置： @Html.TextBox("EditingYpos", "", new { @readonly = "readonly", @style = "border:none;width:150px" })
                <br />

                <span style="width:30%">設計容量：</span>
                @Html.TextBox("EditingDesignCapacity", "", new { @readonly = "readonly", @style = "border:none;width:30%" })
                立方公尺
                <br />

                <span style="width:30%">剩餘容量：</span>
                @Html.TextBox("EditingResidualCapacity", "", new { @readonly = "readonly", @style = "border:none;width:30%" })
                立方公尺
                <br />

                縣市： @Html.TextBox("EditingCity", "", new { @readonly = "readonly", @style = "border:none;width:20%" })
                鄉鎮區： @Html.TextBox("EditingTown", "", new { @readonly = "readonly", @style = "border:none;width:20%" })
                <br />
                <span style="width:20%">地址：</span>
                @Html.TextBox("EditingAddress", "", new { @readonly = "readonly", @style = "border:none;width:80%" })
                <br />
                <span style="width:25%">聯絡人：</span>
                @Html.TextBox("EditingContactPerson", "", new { @readonly = "readonly", @style = "border:none;width:25%" })
                <span style="width:25%">稱呼：</span>
                @Html.TextBox("EditingContactPersonTitle", "", new { @readonly = "readonly", @style = "border:none;width:25%" })
                <br />
                <span style="width:30%">聯絡電話：</span>
                @Html.TextBox("EditingContactPhone", "", new { @readonly = "readonly", @style = "border:none;width:70%" })
                <br />
                <span style="width:30%">更新時間：</span>
                @Html.TextBox("EditingUpdateTime", "", new { @readonly = "readonly", @style = "border:none;width:30%" })
                <span style="width:30%">臨時堆置場：</span>
                @Html.TextBox("EditingIsDump", "", new { @readonly = "readonly", @style = "border:none;width:10%" })
            </div>

            <div id="DeleteArea" style="display:none;text-align:center">
                <br /><br />
                @using (Html.BeginForm("Delete", "EPAxLandfill"))
                {
                    @*<span style="color:red" >編號</span>*@
                    //以下欄位寬度設為0，使其無法顯現
                    @Html.TextBox("DeleteId", "", new { @readonly = "readonly", style = "width:0px;color:red;border:none;" })
                    <input type="submit" class="btn btn-warning" style="margin:5px;padding:5px" value="確定刪除" />
                    <br /><span class="text-warning">刪除後無法回復</span>
                }
            </div>

            <div id="AddArea" style="padding:0px;display:none">
                @using (Html.BeginForm("Add", "EPAxLandfill"))
                {
                    <table class="table table-bordered table-striped">
                        <tr>
                            <td style="width:30%">聯繫單位名稱</td>
                            <td>@Html.TextBox("ContactUnit", "", new { @class = "form-control rounded-0" })</td>
                        </tr>
                        <tr>
                            <td>X座標 </td>
                            <td>@Html.TextBox("Xpos", (string)ViewBag.Xpos, new { @class = "form-control rounded-0" })</td>
                        </tr>
                        <tr>
                            <td>Y座標</td>
                            <td>@Html.TextBox("Ypos", (string)ViewBag.Ypos, new { @class = "form-control rounded-0" })</td>
                        </tr>
                        <tr>
                            <td>設計容量(立方公尺)</td>
                            <td>@Html.TextBox("DesignCapacity", "", new { @class = "form-control rounded-0" })</td>
                        </tr>
                        <tr>
                            <td>剩餘容量(立方公尺)</td>
                            <td>@Html.TextBox("ResidualCapacity", "", new { @class = "form-control rounded-0" })</td>
                        </tr>
                        <tr>
                            <td>地址</td>
                            <td>@Html.TextBox("Address", "", new { @class = "form-control rounded-0" })</td>
                        </tr>
                        <tr>
                            <td>縣市</td>
                            <td>
                                @Html.DropDownList("City", new List<SelectListItem>
                           {
                                new SelectListItem{Text = "基隆市", Value = "基隆市"},
         new SelectListItem{Text = "臺北市",Value = "臺北市",Selected=true},
         new SelectListItem{Text = "新北市",Value = "新北市"},
         new SelectListItem{Text = "桃園市",Value = "桃園市"},
         new SelectListItem{Text = "新竹縣",Value = "新竹縣"},
         new SelectListItem{Text = "新竹市",Value = "新竹市"},
         new SelectListItem{Text = "苗栗縣",Value = "苗栗縣"},
         new SelectListItem{Text = "臺中市",Value = "臺中市"},
         new SelectListItem{Text = "南投縣",Value = "南投縣"},
         new SelectListItem{Text = "彰化縣",Value = "彰化縣"},
         new SelectListItem{Text = "雲林縣",Value = "雲林縣"},
         new SelectListItem{Text = "嘉義縣",Value = "嘉義縣"},
         new SelectListItem{Text = "嘉義市",Value = "嘉義市"},
         new SelectListItem{Text = "臺南市",Value = "臺南市"},
         new SelectListItem{Text = "高雄市",Value = "高雄市"},
         new SelectListItem{Text = "屏東縣",Value = "屏東縣"},
         new SelectListItem{Text = "臺東縣",Value = "臺東縣"},
         new SelectListItem{Text = "花蓮縣",Value = "花蓮縣"},
         new SelectListItem{Text = "宜蘭縣",Value = "宜蘭縣"},
         new SelectListItem{Text = "澎湖縣",Value = "澎湖縣"},
         new SelectListItem{Text = "連江縣",Value = "連江縣"},
         new SelectListItem{Text = "金門縣",Value = "金門縣"},
                           })
                            </td>
                        </tr>

                        <tr>
                            <td>鄉鎮區</td>
                            <td>@Html.TextBox("Town", "", new { @class = "form-control rounded-0" })</td>
                        </tr>
                        <tr>
                            <td>臨時廢棄物堆置場</td>
                            <td>
                                @Html.DropDownList("IsDump", new List<SelectListItem>
                           {
                                new SelectListItem{Text = "是", Value = "是"},
                               new SelectListItem{Text = "否",Value = "否",Selected=true}
                           })
                            </td>
                        </tr>
                        <tr>
                            <td>聯絡人</td>
                            <td>@Html.TextBox("ContactPerson", "", new { style = "width:100%" })</td>
                        </tr>
                        <tr>
                            <td>聯絡人抬頭</td>
                            <td>@Html.TextBox("ContactPersonTitle", "", new { style = "width:100%" })</td>
                        </tr>
                        <tr>
                            <td>聯絡電話</td>
                            <td>@Html.TextBox("ContactPhone", "", new { style = "width:100%" })</td>
                        </tr>
                        <tr>
                            <td colspan="2" align="center">
                                <input type="submit" class="btn btn-danger" style="margin:10px" value="確定儲存" />
                            </td>
                        </tr>
                    </table>
                }
            </div>
        </div>

        <div class="col-12 col-sm-6">
            <div id="MapArea"></div>
        </div>
    </div>
    <br />
    <div class="row">
        <div id="DataArea" class="col-12" style="height:400px;overflow:auto;">
            @{Html.RenderPartial("~/Views/Components/ShowLandfillForEdit.cshtml");}
        </div>
    </div>
</div>

<script>
    function PickItemForEdit(k, ContactUnit, Xpos, Ypos, DesignCapacity, ResidualCapacity, City, Town, Address, IsDump, UpdateTime, ContactPerson, ContactPersonTitle, ContactPhone) {
        $("#DeleteArea").hide(); $("#AddArea").hide();
        $("#EditArea").show();
        $("#EditingId").val(k);
        $("#EditingContactUnit").val(ContactUnit);
        $("#EditingXpos").val(Xpos);
        $("#EditingYpos").val(Ypos);
        $("#EditingDesignCapacity").val(DesignCapacity);
        $("#EditingResidualCapacity").val(ResidualCapacity);
        $("#EditingCity").val(City);
        $("#EditingTown").val(Town);
        $("#EditingAddress").val(Address);
        $("#EditingIsDump").val(IsDump);
        $("#EditingUpdateTime").val(UpdateTime);
        $("#EditingContactPerson").val(ContactPerson);
        $("#EditingContactPersonTitle").val(ContactPersonTitle);
        $("#EditingContactPhone").val(ContactPhone);
        PutMarkOnMap(Xpos, Ypos);
    }
</script>

@*以下函數在用戶選某筆資料後，將ViewBag.Id傳遞到視窗上方表格。
    之前抓不到ViewBag.Id的值，卻能抓到ViewBag.Xpos的值，後來發現後者為數字，
    因此改變堆置場的Id=時間秒數+城市數字碼，變成數字後解決*@

<script>
    function PickItemForDelete(k, x, y) {
        $("#EditArea").hide(); $("#AddArea").hide();
        $("#DeleteArea").show();
        $("#DeleteId").val(k);
        PutMarkOnMap(x, y);
    }
</script>

<script>
    function AddItem() {
        $("#EditArea").hide(); $("#DeleteArea").hide();
        $("#AddArea").show();
    }
</script>

@*以下函數在用戶點地圖後放標記。MapTarget抓取該位置，
    setView轉畫面到該處。如果MarkCollection（儲存標記的集合）不是空的，
    就先清掉再放新的，避免新舊同時出現*@
<script>
    function PutMarkOnMap(x, y) {
        var MapTarget = L.latLng(x, y);
        Map.setView(MapTarget, 14);
        if (MarkCollection != undefined) {
            Map.removeLayer(MarkCollection);
        };
        MarkCollection = L.marker([x, y]).addTo(Map);
    }

    var MapElement = document.getElementById('MapArea');
    MapElement.style = 'height:300px;';
    var Map = L.map(MapElement);
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(Map);
    var MapTarget = L.latLng('25.0400458', '121.55859');
    Map.setView(MapTarget, 14);

    function MapClick(e) {
        var Xvalue = e.latlng.lat.toString();
        var Yvalue = e.latlng.lng.toString();
        if (MarkCollection != undefined) {
            Map.removeLayer(MarkCollection);
        };
        MarkCollection = L.marker([Xvalue, Yvalue]).addTo(Map);
        $("#Xpos").val(Xvalue);
        $("#Ypos").val(Yvalue);
        $("#EditXpos").val(Xvalue);
        $("#EditYpos").val(Yvalue);
    }
    var MarkCollection = {};
    Map.on('click', MapClick);
</script>
